<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Z市场分析器</title>
    <link rel="stylesheet" href="style.css?v=2.1">
    <!-- 使用 CDN 引入库 -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <!-- 顶部导航 -->
    <header class="header">
        <div class="container">
            <h1>⛏️ Minecraft 交易市场</h1>
            <p class="subtitle">智能搜索 · 价格分析 · 数据可视化 · 不法者悬赏</p>
        </div>
    </header>

    <!-- 主容器 -->
    <div class="container">

        <!-- 过滤提示 -->
        <div id="filterNotice" style="display: none;" class="filter-notice">
            🔒 已自动过滤 <span id="filteredCount">0</span> 个保险柜价格（≥ $10,000,000）
        </div>

        <!-- 统计卡片区域 -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">📊</div>
                <div class="stat-info">
                    <div class="stat-label">总交易数</div>
                    <div class="stat-value" id="totalTrades">-</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">👥</div>
                <div class="stat-info">
                    <div class="stat-label">活跃卖家</div>
                    <div class="stat-value" id="totalPlayers">-</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">🎁</div>
                <div class="stat-info">
                    <div class="stat-label">物品种类</div>
                    <div class="stat-value" id="totalItems">-</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">💰</div>
                <div class="stat-info">
                    <div class="stat-label">平均价格</div>
                    <div class="stat-value" id="avgPrice">-</div>
                </div>
            </div>
            <!-- 新增悬赏统计卡片 -->
            <div class="stat-card">
                <div class="stat-icon">🚨</div>
                <div class="stat-info">
                    <div class="stat-label">当前悬赏数</div>
                    <div class="stat-value" id="totalBounties">-</div>
                </div>
            </div>
        </div>

        <!-- 新增：标签页导航添加悬赏模块 -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('market')">🛒 市场交易</button>
            <button class="tab-btn" onclick="switchTab('analysis')">📈 数据分析</button>
            <button class="tab-btn" onclick="switchTab('comparison')">🔍 价格对比</button>
            <button class="tab-btn" onclick="switchTab('bounty')">🚨 不法者悬赏</button>
        </div>

        <!-- 市场交易标签页 -->
        <div id="market-tab" class="tab-content active">
            <div class="filter-section">
                <h3>🔍 高级筛选</h3>
                <div class="filter-grid">
                    <div class="filter-item">
                        <label>价格区间：</label>
                        <div class="price-range">
                            <input type="number" id="minPrice" placeholder="最低价">
                            <span>-</span>
                            <input type="number" id="maxPrice" placeholder="最高价">
                        </div>
                    </div>
                    <div class="filter-item">
                        <label>数量范围：</label>
                        <div class="price-range">
                            <input type="number" id="minQty" placeholder="最少数量">
                            <span>-</span>
                            <input type="number" id="maxQty" placeholder="最多数量">
                        </div>
                    </div>
                    <div class="filter-item">
                        <button class="btn btn-primary" onclick="applyFilters()">应用筛选</button>
                        <button class="btn btn-secondary" onclick="resetFilters()">重置</button>
                    </div>
                </div>
            </div>

            <div class="table-container">
                <table id="marketTable" class="display" style="width:100%">
                    <thead>
                        <tr>
                            <th>玩家</th>
                            <th>物品</th>
                            <th>数量</th>
                            <th>单价</th>
                            <th title="单价 × 数量 = 购买该商品所需总花费">总价 <span class="tooltip-icon">ⓘ</span></th>
                            <th>位置</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 数据分析标签页 -->
        <div id="analysis-tab" class="tab-content">
            <div class="analysis-grid">
                <div class="chart-container">
                    <h3>📊 热门物品 TOP 10</h3>
                    <canvas id="topItemsChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>👑 活跃卖家 TOP 10</h3>
                    <canvas id="topPlayersChart"></canvas>
                </div>
            </div>

            <div class="analysis-grid">
                <div class="chart-container">
                    <h3>💎 最贵物品 TOP 10</h3>
                    <canvas id="expensiveItemsChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>💵 价格分布</h3>
                    <canvas id="priceDistChart"></canvas>
                </div>
            </div>

            <div class="ranking-section">
                <div class="ranking-card">
                    <h3>🏆 大卖家排行榜</h3>
                    <div id="sellerRanking" class="ranking-list"></div>
                </div>
                <div class="ranking-card">
                    <h3>💰 高价物品排行榜</h3>
                    <div id="expensiveRanking" class="ranking-list"></div>
                </div>
            </div>
        </div>

        <!-- 价格对比标签页 -->
        <div id="comparison-tab" class="tab-content">
            <div class="comparison-section">
                <h3>🔍 物品价格对比</h3>
                <p class="hint">在下方搜索框输入物品名称，查看不同卖家的价格对比</p>
                <div class="search-box">
                    <input type="text" id="itemSearch" placeholder="输入物品名称搜索..." oninput="searchItemForComparison()">
                </div>
                <div id="comparisonResults"></div>
            </div>
        </div>

        <!-- 新增：不法者悬赏标签页 -->
        <div id="bounty-tab" class="tab-content">
            <!-- 悬赏发布区域 -->
            <div class="bounty-publish-section">
                <h3>🚨 发布不法者悬赏</h3>
                <p class="hint">举报游戏内诈骗、作弊、恶意骚扰等不法行为，设置赏金寻求线索或制裁</p>
                <div class="publish-form-grid">
                    <div class="form-item">
                        <label>不法者ID：</label>
                        <input type="text" id="criminalId" placeholder="输入涉嫌违规的玩家ID" required>
                    </div>
                    <div class="form-item">
                        <label>违规类型：</label>
                        <select id="crimeType" required>
                            <option value="">选择违规类型</option>
                            <option value="scam">交易诈骗</option>
                            <option value="cheat">游戏作弊</option>
                            <option value="harass">恶意骚扰</option>
                            <option value="grief">破坏建筑</option>
                            <option value="other">其他违规</option>
                        </select>
                    </div>
                    <div class="form-item">
                        <label>悬赏金额：</label>
                        <input type="number" id="bountyAmount" placeholder="设置悬赏奖励（游戏货币）" min="1" required>
                    </div>
                    <div class="form-item">
                        <label>悬赏描述：</label>
                        <textarea id="bountyDesc" placeholder="详细描述违规行为、时间、地点等线索（必填）" rows="3" required></textarea>
                    </div>
                    <div class="form-item">
                        <label>联系人ID：</label>
                        <input type="text" id="contactId" placeholder="你的游戏ID（便于提供线索者联系）" required>
                    </div>
                    <div class="form-item submit-item">
                        <button class="btn btn-danger" onclick="publishBounty()">发布悬赏</button>
                        <button class="btn btn-secondary" onclick="clearBountyForm()">清空</button>
                    </div>
                </div>
            </div>

            <!-- 悬赏筛选区域 -->
            <div class="filter-section bounty-filter">
                <h3>🔍 悬赏筛选</h3>
                <div class="filter-grid">
                    <div class="filter-item">
                        <label>违规类型：</label>
                        <select id="bountyTypeFilter">
                            <option value="all">全部类型</option>
                            <option value="scam">交易诈骗</option>
                            <option value="cheat">游戏作弊</option>
                            <option value="harass">恶意骚扰</option>
                            <option value="grief">破坏建筑</option>
                            <option value="other">其他违规</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label>悬赏金额：</label>
                        <div class="price-range">
                            <input type="number" id="minBounty" placeholder="最低金额">
                            <span>-</span>
                            <input type="number" id="maxBounty" placeholder="最高金额">
                        </div>
                    </div>
                    <div class="filter-item">
                        <label>搜索不法者：</label>
                        <input type="text" id="criminalSearch" placeholder="输入玩家ID搜索">
                    </div>
                    <div class="filter-item">
                        <button class="btn btn-primary" onclick="applyBountyFilters()">应用筛选</button>
                        <button class="btn btn-secondary" onclick="resetBountyFilters()">重置</button>
                    </div>
                </div>
            </div>

            <!-- 悬赏列表区域 -->
            <div class="bounty-list-container">
                <h3>📋 当前不法者悬赏列表</h3>
                <div id="bountyEmptyState" class="empty-state" style="display: none;">
                    <div class="empty-icon">🚨</div>
                    <h4>暂无相关悬赏</h4>
                    <p>可以发布第一个不法者悬赏，维护游戏环境！</p>
                </div>
                <table id="bountyTable" class="display" style="width:100%">
                    <thead>
                        <tr>
                            <th>不法者ID</th>
                            <th>违规类型</th>
                            <th>悬赏金额</th>
                            <th>发布者</th>
                            <th>发布时间</th>
                            <th>违规描述</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="bountyTableBody">
                        <!-- 悬赏数据将通过JS动态加载 -->
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <!-- 页脚 -->
    <footer class="footer">
        <p>zzzzzyc@hotmail.com zzzzzyc@2025版权所有 | 数据更新时间: <span id="updateTime">-</span></p>
    </footer>

    <script src="app.js?v=2.1"></script>
</body>
</html>